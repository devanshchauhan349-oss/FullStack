<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Drawing Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        canvas {
            border: 2px solid #333;
            background-color: white;
            cursor: crosshair;
            margin: 10px 0;
        }
        .controls {
            margin-bottom: 15px;
        }
        button {
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        input[type="color"] {
            width: 50px;
            height: 40px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>SVG Drawing Tool</h1>
    
    <div class="controls">
        <label>Color: <input type="color" id="colorPicker" value="#000000"></label>
        <label>Size: <input type="range" id="brushSize" min="1" max="20" value="3"></label>
        <button id="clearBtn">Clear</button>
        <button id="addCircleBtn">Add Circle</button>
        <span style="margin-left:10px; font-weight:bold">Circles: <span id="circleCount">0</span></span>
        <button id="downloadBtn">Download</button>
    </div>

    <svg id="svgCanvas" xmlns="http://www.w3.org/2000/svg" width="800" height="600"></svg>

    <script>
        const svg = document.getElementById('svgCanvas');
        const colorPicker = document.getElementById('colorPicker');
        const brushSize = document.getElementById('brushSize');
        const clearBtn = document.getElementById('clearBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const addCircleBtn = document.getElementById('addCircleBtn');
        const circleCountEl = document.getElementById('circleCount');

        let circleCount = 0;
        let isDrawing = false;

        // add circle at given coordinates
        function addCircleAt(x, y) {
            const r = Math.max(1, parseInt(brushSize.value, 10) * 2);
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', x);
            circle.setAttribute('cy', y);
            circle.setAttribute('r', r);
            circle.setAttribute('fill', colorPicker.value);
            svg.appendChild(circle);

            circleCount += 1;
            circleCountEl.textContent = circleCount;
        }

        // throttle creation to avoid extreme number of circles
        let lastTime = 0;
        const throttleMs = 40; // create at most ~25 circles/sec

        svg.addEventListener('mousedown', (e) => {
            if (e.button === 0) { // left mouse button
                isDrawing = true;
            }
        });

        // stop drawing when mouse released anywhere
        window.addEventListener('mouseup', () => { isDrawing = false; });

        svg.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            const now = Date.now();
            if (now - lastTime < throttleMs) return;
            lastTime = now;

            const rect = svg.getBoundingClientRect();
            const x = Math.round(e.clientX - rect.left);
            const y = Math.round(e.clientY - rect.top);
            addCircleAt(x, y);
        });

        // add circle button (also allows manual circle addition)
        addCircleBtn.addEventListener('click', () => {
            // add at center
            addCircleAt(Math.round(svg.clientWidth / 2), Math.round(svg.clientHeight / 2));
        });

        clearBtn.addEventListener('click', () => {
            while (svg.firstChild) svg.removeChild(svg.firstChild);
            circleCount = 0;
            circleCountEl.textContent = circleCount;
        });

        downloadBtn.addEventListener('click', () => {
            const serializer = new XMLSerializer();
            const svgClone = svg.cloneNode(true);
            // ensure namespace present
            svgClone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
            const source = serializer.serializeToString(svgClone);
            const blob = new Blob([source], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.href = url;
            link.download = 'drawing.svg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>